/*! mAgenda 3.1
 */
var site = "http://magenda.mvanvuren.local",
  defaultLanguage = "nl",
  defaultCityCode = 1000,
  defaultCityId = 616,
  defaultRange = 30;
$(document).on("mobileinit", function () {
  $.cookie("width", screen.width, { expires: 365 });
  initLanguage();
  if ($.cookie("cityid") == null) {
    initSettings();
  }
});
$(function () {
  $("div[data-role=panel]").panel().enhanceWithin();
  $("div[data-role=popup]").popup().enhanceWithin();
  $(document).on("pageshow", 'div[data-role="page"]', function () {
    $("#listview", this).on("click", "li", function (a) {
      $.get("event.php?id=" + $(this).attr("data-id"), function (b) {
        $("#event > ul").html(b);
        $("#event").listview().listview("refresh");
      });
    });
  });
  $(document).on("pageshow", 'div[data-role="page"]', function (c) {
    try {
      var a = _gat._getTracker("UA-12677950-3");
      a._trackPageview(c.target.id);
    } catch (b) {}
  });
  $(document).on("pagecreate", "#settings", function (a) {
    $("#reset", this).click(function () {
      resetSettings();
    });
    $("#save", this).click(function () {
      saveSettings();
    });
  });
});
function initLanguage() {
  if ($.cookie("language") == "nl") {
    $.mobile.listview.prototype.options.filterPlaceholder = "Filteren op...";
    $.mobile.loadingMessage = "laden";
    $.mobile.pageLoadErrorMessage = "Fout bij laden pagina";
  }
}
function initSettings() {
  $.cookie("code", defaultCityCode, { expires: 365 });
  $.cookie("cityid", defaultCityId, { expires: 365 });
  $.cookie("range", defaultRange, { expires: 365 });
  $.cookie("language", defaultLanguage, { expires: 365 });
  getGeoLocation();
}
function resetSettings() {
  initSettings();
  reloadPage("settings.php");
}
function saveSettings() {
  var b = jQuery.mobile.activePage,
    c = $("#cities", b).val(),
    a = Number($.trim($("#range", b).val()));
  $.cookie("code", c, { expires: 365 });
  $.cookie("cityid", $("#cities :selected", b).attr("data-id"), {
    expires: 365,
  });
  $.cookie("range", a, { expires: 365 });
  $.cookie(
    "language",
    $("input:radio[name=language]:checked", $.mobile.activePage).val(),
    { expires: 365 }
  );
  reloadPage("settings.php");
}
function reloadPage(a) {
  document.location.href = a;
}
function getGeoLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(a, b, { timeout: 10000 });
  } else {
    noLocation();
  }
  function a(c) {
    foundLocation(c.coords.latitude, c.coords.longitude);
  }
  function b(c) {
    noLocation();
  }
}
function noLocation() {
  $.ajax({
    url: "http://www.geoplugin.net/json.gp?jsoncallback=?",
    dataType: "json",
    async: false,
    success: function (a) {
      foundLocation(a.geoplugin_latitude, a.geoplugin_longitude);
    },
  });
}
function foundLocation(b, a) {
  $.ajax({
    url: "jsongeocode.php",
    data: { latitude: b, longitude: a },
    dataType: "json",
    async: false,
    success: function (c) {
      $.cookie("code", c.code, { expires: 365 });
      $.cookie("cityid", c.cityid, { expires: 365 });
    },
  });
}
